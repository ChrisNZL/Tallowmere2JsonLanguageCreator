$(document).ready(function() {

	// Get languages
	var languageIndices = [];
	$('tbody tr').each(function(index, tr){
		// Language row
		if (index == 0) {
			$('td', tr).each(function (index2, td){
				var language = $(td).text();
				if (language.length > 0) {
					if (language.substring(0, 2) != '//') {
						languageIndices[language] = index2;
						console.log('Added language ' + language + ' as index ' + index2);
					}
				}
			});
		}
	});

	// Add HTML to top of page
	$('body').prepend(
		'<div id="Converter" style="padding:20px">' +
			'Select a language to convert: ' +
			'<select>' +
				GetOptions() +
			'</select> ' +
			'<button>Convert to JSON</button>' +
		"</div>"
	);

	// Populate the select list
	function GetOptions () {
		var options = '';
		//for (var i = 0; i < languageIndices.length; i++) {
		for (var key in languageIndices) {
			options += '<option value="' + key + '">' + key + '</option>';
		}
		return options;
	}

	// Do conversion
	$('button').click(function(){
		var tab = '	';
		var columnNumber = languageIndices[$('select').val()];

		var json = '{\n';
		json += tab + '// THIS FILE IS AUTOMATICALLY GENERATED. DO NOT EDIT.\n\n'
		json += tab + '// ' + $('select').val() + '\n\n';

		$('tr').each(function(index, tr){
			var firstColumnString = $('td', tr).eq(0).text();
			
			if (firstColumnString.length > 0) {
				// Is this a comment?
				if (firstColumnString.substring(0, 2) == "//") {
					json += tab + firstColumnString + '\n';
				}
				// This is a key
				else {
					var keyString = firstColumnString;
					var valueString = $('td', tr).eq(columnNumber).text();
					json += tab + '"' + keyString + '": "' + valueString + '",\n';
				}
			}
			else {
				json += '\n';
			}
		});

		// Remove trailing comma and newline
		json = json.substring(0, json.length-2) + '\n';

		json += '}\n';

		$('#Converter').append(
			'<br /><br />Here is your JSON: <br />' +
			'<textarea style="width:80%; height:80%"">' + json + '</textarea>'
		);
	});

});